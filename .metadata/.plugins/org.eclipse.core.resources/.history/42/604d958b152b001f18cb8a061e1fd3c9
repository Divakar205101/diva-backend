package com.div.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.div.domain.MemberVO;
import com.div.domain.ModuleVO;
import com.div.mo.MemberMO;
import com.div.mto.MemberMTO;
import com.div.service.MemberService;
import com.fasterxml.jackson.databind.ObjectMapper;

@RestController
@RequestMapping(value = "/core")
public class MemberController {
	
	private static final String SAVEUSER="/saveUser";
	private static final String ACTION = "action";
	private static final String GET_ALL = "/getmembers";
	private static final String EDIT = "/editmember";
	
	@Autowired private ObjectMapper mapper;
	@Autowired private  MemberService userService;
	
	 
	@PostMapping(value=SAVEUSER)
	 public ResponseEntity<MemberMTO> createUser(@RequestParam(ACTION) String fooId,@RequestBody MemberMTO memberMTO){
		 try {
			 MemberMO memberMO = mapper.convertValue(memberMTO, MemberMO.class); 
			userService.createUser(memberMO.getMemberVO());
		} catch (Exception e) {
			 e.printStackTrace();
		}
	     return new ResponseEntity<>(memberMTO, HttpStatus.CREATED);
	 }
	
	   @GetMapping(value = "/edit")
	    public ResponseEntity<MemberVO> edit(@RequestParam("memberId") Integer memberId) {
	       MemberVO userById = userService.getUserById(memberId);
	        if (userById != null) {
	            return ResponseEntity.ok(userById); 
	        } else {
	            return ResponseEntity.notFound().build(); 
	        }
	    }
	
	 @GetMapping(value=GET_ALL)
	 public ResponseEntity<List<MemberVO>> getAll() {
		return new ResponseEntity<>(userService.getAllUsers(),HttpStatus.OK);
	}
}
